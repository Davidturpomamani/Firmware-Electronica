#include <Wire.h>
#include <Adafruit_MCP4725.h>
int funciones = 0;
int frecuencia = 0;

Adafruit_MCP4725 dac;

const PROGMEM uint16_t DACLookup_Sine_100[100] =
{
 2048, 2176, 2304, 2431, 2557, 2680, 2801, 2919,
 3034, 3145, 3251, 3353, 3449, 3540, 3625, 3704,
 3776, 3842, 3900, 3951, 3995, 4031, 4059, 4079,
 4091, 4095, 4091, 4079, 4059, 4031, 3995, 3951,
 3900, 3842, 3776, 3704, 3625, 3540, 3449, 3353,
 3251, 3145, 3034, 2919, 2801, 2680, 2557, 2431,
 2304, 2176, 2048, 1919, 1791, 1664, 1538, 1415,
 1294, 1176, 1061,  950,  844,  742,  646,  555,
  470,  391,  319,  253,  195,  144,  100,   64,
   36,   16,    4,    0,    4,   16,   36,   64,
  100,  144,  195,  253,  319,  391,  470,  555,
  646,  742,  844,  950, 1061, 1176, 1294, 1415,
 1538, 1664, 1791, 1919
};

const PROGMEM uint16_t DACLookup_Triangle_100[100] =
{
    0,   82,  164,  246,  328,  410,  491,  573, 
  655,  737,  819,  901,  983, 1065, 1147, 1229,
 1310, 1392, 1474, 1556, 1638, 1720, 1802, 1884,
 1966, 2048, 2129, 2211, 2293, 2375, 2457, 2539,
 2621, 2703, 2785, 2867, 2948, 3030, 3112, 3194,
 3276, 3358, 3440, 3522, 3604, 3686, 3767, 3849,
 3931, 4013, 4095, 4013, 3931, 3849, 3767, 3686,
 3604, 3522, 3440, 3358, 3276, 3194, 3112, 3030,
 2948, 2867, 2785, 2703, 2621, 2539, 2457, 2375,
 2293, 2211, 2129, 2048, 1966, 1884, 1802, 1720,
 1638, 1556, 1474, 1392, 1310, 1229, 1147, 1065,
  983,  901,  819,  737,  655,  573,  491,  410,
  328,  246,  164,   82 
};

const PROGMEM uint16_t DACLookup_Saw_100[100] =
{
    0,   41,   82,  123,  164,  205,  246,  287, 
  328,  369,  410,  451,  491,  533,  573,  615,
  655,  697,  737,  779,  819,  861,  901,  943, 
  983, 1025, 1065, 1107, 1147, 1189, 1229, 1271,
 1310, 1353, 1392, 1433, 1474, 1515, 1556, 1597,
 1638, 1679, 1720, 1761, 1802, 1843, 1884, 1925,
 1966, 2007, 2048, 2089, 2129, 2171, 2211, 2253,
 2293, 2334, 2375, 2416, 2457, 2498, 2539, 2580,
 2621, 2662, 2703, 2744, 2785, 2826, 2867, 2908,
 2948, 2989, 3030, 3071, 3112, 3153, 3194, 3235,
 3276, 3317, 3358, 3399, 3440, 3481, 3522, 3563,
 3604, 3645, 3686, 3727, 3767, 3809, 3849, 3891,
 3931, 3973, 4013, 4095
};

void setup(void){
   dac.begin(0x62);
   pinMode(2, INPUT_PULLUP);
   attachInterrupt(digitalPinToInterrupt(2), funcion, LOW);
}

void senoidal(void){
   uint16_t i;
   for(i = 0; i < 100; i++){
      dac.setVoltage(pgm_read_word(&(DACLookup_Sine_100[i])), false);
      delayMicroseconds(frecuencia);
   }
}

void triangular(void){
   uint16_t i;
   for(i = 0; i < 100; i++){
      dac.setVoltage(pgm_read_word(&(DACLookup_Triangle_100[i])), false);
      delayMicroseconds(frecuencia);
   }
}

void dienteUp(void){
   uint16_t i;
   for(i = 0; i < 100; i++){
      dac.setVoltage(pgm_read_word(&(DACLookup_Saw_100[i])), false);
      delayMicroseconds(frecuencia);
   } 
}

void funcion(void){
   if(funciones<4)
      funciones++;
   if(funciones==3)
      funciones=0;
}

void loop(void){
   frecuencia = analogRead(A0)+1;
   switch(funciones){
   case 0:
      senoidal();
      break;      
   case 1:
      triangular();
      break;
   case 2:
      dienteUp();
      break;
   default:
      break;  
   }
}
